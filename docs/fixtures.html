
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Fixtures &#8212; libcester  documentation</title>
    <link rel="stylesheet" href="../_static/css/milkiish.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/libcester.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/libcester.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation" href="index.html" />
    <link rel="prev" title="Assertion Macros" href="assertions.html" />
   
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

    <div class="document">
    <header>
        <div class="topnavbar">
            
                <img class="icon" src="../_static/libcester.png"></img>
            
            <a href="../index.html" class="title">libcester</a>
            
                <a href="/libcester/docs/">Docs</a> <!-- class="active" -->
            
                <a href="/libcester/reference/">Reference</a> <!-- class="active" -->
            
                <a href="https://github.com/exoticlibraries/libcester/">Contribute on Github</a> <!-- class="active" -->
            
                <a href="https://exoticlibraries.github.io/">Exotic Libraries</a> <!-- class="active" -->
            
            <div class="search-container">
                <form class="search" action="../search.html" method="get">
                    <button type="submit"><i class="fa fa-search"></i></button>
                    <input type="text" placeholder="" name="q">
                </form>
            </div>
        </div>
    </header>
    <div class="documentwrapper">
        
            
                
                <div class="sidebar-left">
                    </br>
                    <p class="caption"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../screenshots.html">Screenshots</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="assertions.html">Assertion Macros</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Test Fixtures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="macros.html">Helper Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual_test_registration.html">Manual Tests Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="mocking.html">Mocking</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Cester Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_formats.html">Output Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_for_failure.html">Testing for failures</a></li>
</ul>
<p class="caption"><span class="caption-text">How it works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_assertion_macro.html">How the assertion macros works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_mocking.html">How the mocking works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_test_registration_works.html">How test registration works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/index.html">How it works</a></li>
</ul>

                </div>
                
            
        
        <div class="bodywrapper">
                
  <div class="section" id="test-fixtures">
<span id="index-0"></span><h1>Test Fixtures<a class="headerlink" href="#test-fixtures" title="Permalink to this headline">¶</a></h1>
<p>In writing code for tests it time consuming setting up the test fixtures before running the
test cases and dissposing the fixtures after the test completes.</p>
<p>cester supports sharing the fixture mangement code between test cases. The following macros
can be used in seting up and destroying objects used for test.</p>
<ul class="simple">
<li><p><a class="reference external" href="./macros.html#cester-before-all">CESTER_BEFORE_ALL</a></p></li>
<li><p><a class="reference external" href="./macros.html#cester-before-each">CESTER_BEFORE_EACH</a></p></li>
<li><p><a class="reference external" href="./macros.html#cester-after-each">CESTER_AFTER_EACH</a></p></li>
<li><p><a class="reference external" href="./macros.html#cester-after-all">CESTER_AFTER_ALL</a></p></li>
</ul>
<div class="section" id="test-instance-object">
<h2>Test Instance Object<a class="headerlink" href="#test-instance-object" title="Permalink to this headline">¶</a></h2>
<p>Each test case accept a second parameter after the name, the second parameter is the
test_instance object that can be used to share datas and objects between test cases without
the need of using global variable. The structure of the test case is shown below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">test_instance</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="n">argc</span><span class="p">;</span>
        <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">;</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">;</span>
<span class="p">}</span> <span class="n">TestInstance</span><span class="p">;</span>
</pre></div>
</div>
<p>The <cite>argc</cite> value is the length of the command line arguments, <cite>argv</cite> is the array of command
line arguments. <cite>arg</cite> is a pointer that can hold any extra data which all the test cases can
have access to.</p>
<p>The following example shows how a string is shared between the test cases using the
test_instance object instead of a global variable.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;exotic/cester.h&gt;</span><span class="cp"></span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">assign_arg</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">cester_assert_not_equal</span><span class="p">(</span><span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;beforeall&quot;</span><span class="p">);</span>
        <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span> <span class="o">=</span> <span class="s">&quot;beforeall&quot;</span><span class="p">;</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">check_arg</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">cester_assert_str_equal</span><span class="p">(</span><span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;beforeall&quot;</span><span class="p">);</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+ (0.00s) assign arg
+ (0.00s) check arg

Passed crash_test.c:6: in &#39;assign_arg&#39; =&gt; not expecting &#39;test_instance-&gt;arg&#39;, received &#39;&quot;beforeall&quot;&#39;
Passed crash_test.c:11: in &#39;check_arg&#39; =&gt; expected &#39;beforeall&#39;, received &#39;beforeall&#39;

Ran 2 test(s) in 0.00 Seconds
Synthesis: SUCCESS Tests: 2 | Passing: 2 | Failing: 0
</pre></div>
</div>
</div>
<div class="section" id="cester-before-all-and-cester-after-all">
<h2>CESTER_BEFORE_ALL and CESTER_AFTER_ALL<a class="headerlink" href="#cester-before-all-and-cester-after-all" title="Permalink to this headline">¶</a></h2>
<p>Before any test case is run the codes in the macro <cite>CESTER_BEFORE_ALL</cite> is executed.
CESTER_BEFORE_ALL is where the objects to be used in the test is created. Once all the test
cases has finished running, whether the test passed or failed, the codes in the macro
<cite>CESTER_AFTER_ALL</cite> is executed. CESTER_AFTER_ALL is where the objects used in the test is
destroyed.</p>
<p>The example below uses the <cite>CESTER_BEFORE_ALL</cite> and <cite>CESTER_AFTER_ALL</cite> to manage objects
used in a test.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;exotic/cester.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;exotic/array.h&gt;</span><span class="cp"></span>

<span class="n">CESTER_BEFORE_ALL</span><span class="p">(</span><span class="n">test_instance</span><span class="p">,</span>
        <span class="n">Array</span><span class="o">*</span> <span class="n">array</span><span class="p">;</span>
        <span class="k">enum</span> <span class="n">x_stat</span> <span class="n">status</span><span class="p">;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">array_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">);</span>
        <span class="n">array_add</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s">&quot;Hello&quot;</span><span class="p">);</span>
        <span class="n">array_add</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s">&quot;World&quot;</span><span class="p">);</span>

        <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span> <span class="o">=</span> <span class="n">array</span><span class="p">;</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">check_initial_value_at_1</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">Array</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">Array</span> <span class="o">*</span><span class="p">)</span> <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">;</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">out</span><span class="p">;</span>

        <span class="n">array_get_at</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
        <span class="n">cester_assert_str_not_equal</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">out</span><span class="p">);</span>
        <span class="n">cester_assert_str_equal</span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">out</span><span class="p">);</span>
        <span class="n">array_add_at</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">check_modified_value_at_1</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">Array</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">Array</span> <span class="o">*</span><span class="p">)</span> <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">;</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">out</span><span class="p">;</span>

        <span class="n">array_get_at</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">);</span>
        <span class="n">cester_assert_str_not_equal</span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">out</span><span class="p">);</span>
        <span class="n">cester_assert_str_equal</span><span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">out</span><span class="p">);</span>
<span class="p">)</span>

<span class="n">CESTER_AFTER_ALL</span><span class="p">(</span><span class="n">test_instance</span><span class="p">,</span>
        <span class="n">Array</span><span class="o">*</span> <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">Array</span> <span class="o">*</span><span class="p">)</span> <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">;</span>
        <span class="n">array_destroy</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+ (0.00s) check initial value at 1
+ (0.00s) check modified value at 1

Passed test_array.c:21: in &#39;check_initial_value_at_1&#39; =&gt; not expecting &#39;Hello&#39;, received &#39;World&#39;
Passed test_array.c:22: in &#39;check_initial_value_at_1&#39; =&gt; expected &#39;World&#39;, received &#39;World&#39;
Passed test_array.c:31: in &#39;check_modified_value_at_1&#39; =&gt; not expecting &#39;World&#39;, received &#39;Hello World&#39;
Passed test_array.c:32: in &#39;check_modified_value_at_1&#39; =&gt; expected &#39;Hello World&#39;, received &#39;Hello World&#39;

Ran 2 test(s) in 0.00 Seconds
Synthesis: SUCCESS Tests: 2 | Passing: 2 | Failing: 0
</pre></div>
</div>
<p>In the test above an array object is created in the CESTER_BEFORE_ALL macro and destroyed in
the CESTER_AFTER_ALL macro. The two test cases are able to share the same array object created.</p>
<p>It not a must to use the macros CESTER_AFTER_ALL and CESTER_BEFORE_ALL in one test code,
the objects that needs cleanup like a database object opened in CESTER_BEFORE_ALL can then be
closed in CESTER_AFTER_ALL. Only one of the two macro or a mix of both can be in a test.</p>
</div>
<div class="section" id="cester-before-each-and-cester-after-each">
<h2>CESTER_BEFORE_EACH and CESTER_AFTER_EACH<a class="headerlink" href="#cester-before-each-and-cester-after-each" title="Permalink to this headline">¶</a></h2>
<p>In a scenerio whereby an object needs to be changed according to the active test case the macro
CESTER_BEFORE_EACH and CESTER_AFTER_EACH come into the picture. Both macro accepts three
parameters the first is the Test instead object, the second is the current test case name that
is been executed and the last argument is the index of the active test case.</p>
<p>The example below set the shared argument to the name of the active text case:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;exotic/cester.h&gt;</span><span class="cp"></span>

<span class="n">CESTER_BEFORE_EACH</span><span class="p">(</span><span class="n">test_instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Before TestCase &#39;%s&#39;, at index &#39;%d&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
        <span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">first_test_case</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">cester_assert_str_equal</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;first_test_case&quot;</span><span class="p">);</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">second_test_case</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
        <span class="n">cester_assert_str_equal</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">test_instance</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">,</span> <span class="s">&quot;second_test_case&quot;</span><span class="p">);</span>
<span class="p">)</span>

<span class="n">CESTER_AFTER_EACH</span><span class="p">(</span><span class="n">test_instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;After TestCase &#39;%s&#39;, at index &#39;%d&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Before TestCase &#39;first_test_case&#39;, at index &#39;1&#39;
After TestCase &#39;first_test_case&#39;, at index &#39;1&#39;
Before TestCase &#39;second_test_case&#39;, at index &#39;2&#39;
After TestCase &#39;second_test_case&#39;, at index &#39;2&#39;

+ (0.00s) first test case
+ (0.01s) second test case

Passed crash_test.c:11: in &#39;first_test_case&#39; =&gt; expected &#39;first_test_case&#39;, received &#39;first_test_case&#39;
Passed crash_test.c:15: in &#39;second_test_case&#39; =&gt; expected &#39;second_test_case&#39;, received &#39;second_test_case&#39;

Ran 2 test(s) in 0.01 Seconds
Synthesis: SUCCESS Tests: 2 | Passing: 2 | Failing: 0
</pre></div>
</div>
<p>It not a must to use the macros CESTER_AFTER_EACH and CESTER_BEFORE_EACH in one test code.
Only one of the two macro or a mix of both can be in a test.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>using any of the macro CESTER_BEFORE_ALL, CESTER_AFTER_EACH, CESTER_AFTER_EACH,
CESTER_BEFORE_ALL will disable running each of the test cases on different process,
so that the shared data is preserved between the test cases. signal.h will be used to
catch and recover from crashes test cases.</p>
</div>
</div>
</div>


                
                </br>
                 
                    
                        <div class="navigation">
                            
                                <a class="reference navigator" style="float:left;" href="https://github.com/exoticlibraries/libcester/edit/master/docs/docs/fixtures.rst"><i class="fa fa-pen"></i>Edit this page</a>    
                            
                            <a class="reference navigator" style="float:left;" href="../genindex.html"><i class="fa fa-book"></i>Index</a>
                            
                            
                                <a class="reference navigator" style="float:right;" href="index.html">Documentation<i class="fa fa-arrow-right"></i></a> 
                            
                            
                                <a class="reference navigator" style="float:right;" href="assertions.html"><i class="fa fa-arrow-left"></i>Assertion Macros</a>
                            
                        </div>
                    
                
        </div>
        
            
                
                <div class="sidebar-right">
                    
                        <h2>Page Contents</h2>
                        <ul>
<li><a class="reference internal" href="#">Test Fixtures</a><ul>
<li><a class="reference internal" href="#test-instance-object">Test Instance Object</a></li>
<li><a class="reference internal" href="#cester-before-all-and-cester-after-all">CESTER_BEFORE_ALL and CESTER_AFTER_ALL</a></li>
<li><a class="reference internal" href="#cester-before-each-and-cester-after-each">CESTER_BEFORE_EACH and CESTER_AFTER_EACH</a></li>
</ul>
</li>
</ul>

                        
                            <h2>Previous topic</h2>
                            <a href="assertions.html">Assertion Macros</a>
                        
                        
                            <h2>Next topic</h2>
                            <a href="index.html">Documentation</a>
                        
                        <h2>This Page</h2>
                        <a href="../_sources/docs/fixtures.rst.txt">Show source</a>
                        
                            <br/><a style="line-height: 25px;" href="https://github.com/exoticlibraries/libcester/edit/master/docs/docs/fixtures.rst">Edit this page</a>
                        
                    
                </div>
                
            
        
        <div style="clear:both"></div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        <div class="social">
            
                <a href="https://twitter.com/exoticlibs"><i class="fab fa-twitter"></i></a>
            
                <a href="https://github.com/exoticlibraries/libcester/"><i class="fab fa-github"></i></a>
            
        </div>
        <div class="footer-col1">
            
        </div>
        
        
        <div class="doc-sphinx-info">
                    &copy; Copyright 2020, Adewale Azeez, MIT License.
                Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.2.1
                with <a href="https://thecarisma.github.io/themata/milkish/index.html">milkish</a> theme.
        </div>
    </div>
    

  </body>
</html>