
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Mocking &#8212; libcester  documentation</title>
    <link rel="stylesheet" href="../_static/css/milkiish.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/libcester.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/libcester.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cester Options" href="options.html" />
    <link rel="prev" title="Documentation" href="index.html" />
   
  
  
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  
    
    <meta name="description" content="libcester is a header only automated testing framework for the C programming language, it requires no dependency and can be downloaded and used in a project immediately.">
    <meta name="keywords" content="thecarisma, c, cpp, c++, unit testing, framework, exoticlibraries, exotic, libraries, regression, test">
    <meta name="author" content="Adewale Azeez">
    <meta property="og:url" content="https://exoticlibraries.github.io/libcester/docs/mocking.html" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="A robust header only unit testing framework for C programming language." />
    <meta property="og:description" content="libcester is a header only automated testing framework for the C programming language, it requires no dependency and can be downloaded and used in a project immediately." />
    <meta property="og:image" content="https://raw.githubusercontent.com/exoticlibraries/libcester/main/docs/libcester.png" />
    
  
  
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@exoticlibs" />
    <meta name="twitter:creator" content="@iamthecarisma" />
    <meta name="twitter:title" content="A robust header only unit testing framework for C programming language." />
    <meta name="twitter:description" content="libcester is a header only automated testing framework for the C programming language, it requires no dependency and can be downloaded and used in a project immediately." />
    <meta name="twitter:image" content="https://raw.githubusercontent.com/exoticlibraries/libcester/main/docs/libcester.png" />
    
  

  </head><body>

    <div class="document">
    <header>
        <div class="topnavbar">
            
                <img class="icon" src="../_static/libcester.png"></img>
            
            <a href="../index.html" class="title">libcester</a> <!-- class="active" -->
            
                
                    <a href="index.html">Doc</a>
                
            
                
                    <a href="../reference/index.html">Reference</a>
                
            
                
                    <a href="https://github.com/exoticlibraries/libcester/">Contribute</a> 
                
            
                
                    <a href="https://exoticlibraries.github.io/">Exotic Libraries</a> 
                
            
                
                    <a href="https://exoticlibraries.github.io/pages/support.html">Support</a> 
                
            
            <div class="search-container">
                <form class="search" action="../search.html" method="get">
                    <button type="submit"><i class="fa fa-search"></i></button>
                    <input type="text" placeholder="" name="q">
                </form>
            </div>
        </div>
    </header>
    <div class="documentwrapper">
        
            
                
                <div class="sidebar-left">
                    </br>
                    <p class="caption"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../screenshots.html">Screenshots</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="assertions.html">Assertion Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixtures.html">Test Fixtures</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Unfixed Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="macros.html">Helper Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual_test_registration.html">Manual Tests Registration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mocking</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Cester Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_formats.html">Output Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="selective_compilation.html">Selective Modular Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_for_failure.html">Testing for failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_information.html">Test Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing_stream.html">Testing Output Streams</a></li>
</ul>
<p class="caption"><span class="caption-text">How it works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_assertion_macro.html">How the assertion macros works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_mocking.html">How the mocking works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_stream_capture_works.html">How the stream capture is implemented</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/how_test_registration_works.html">How test registration works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works/index.html">How it works</a></li>
</ul>

                </div>
                
            
        
        <div class="bodywrapper">
                
  <div class="section" id="mocking">
<span id="index-0"></span><h1>Mocking<a class="headerlink" href="#mocking" title="Permalink to this headline">¶</a></h1>
<p>cester supports mocking function. The mock feature currently works on GCC compiler only because
of the use of the <cite>–wrap</cite> option which is not supported on MAC OSX and might not be available in other compilers.</p>
<p>The following macros are use for mocking</p>
<ul class="simple">
<li><a class="reference external" href="./macros.html#define-cester-no-mock">CESTER_NO_MOCK</a></li>
<li><a class="reference external" href="./macros.html#cester-mock-simple-function">CESTER_MOCK_SIMPLE_FUNCTION</a></li>
<li><a class="reference external" href="./macros.html#cester-mock-function">CESTER_MOCK_FUNCTION</a></li>
</ul>
<div class="section" id="mocking-a-simple-function">
<h2>Mocking a simple function<a class="headerlink" href="#mocking-a-simple-function" title="Permalink to this headline">¶</a></h2>
<p>The macro CESTER_MOCK_SIMPLE_FUNCTION can be used to mock a function to return a value.
The macro simply wrap the function to return the third parameter when invoked.</p>
<p>Example:</p>
<p>The following test mock a function that accepts no parameter and return a value.</p>
<p><strong>originals.c</strong></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">multiply_by</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">multiply_a_number</span><span class="p">(</span><span class="nb">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">multiply_by</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>test_mock.c</strong></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;exotic/cester.h&gt;</span>
<span class="c1">#include &quot;originals.c&quot;</span>

<span class="n">CESTER_MOCK_SIMPLE_FUNCTION</span><span class="p">(</span><span class="n">multiply_by</span><span class="p">(),</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">check_mocked_function</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
    <span class="n">cester_assert_equal</span><span class="p">(</span><span class="n">multiply_a_number</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Compile your test file with the –wrap option e.g. in the example above the function
<cite>multiply_by</cite> was mocked so the option <em>-Wl,–wrap=multiply_by</em> is supplied during
compilation.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="n">test_mock</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">I</span><span class="o">.</span> <span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">wrap</span><span class="o">=</span><span class="n">multiply_by</span> <span class="o">-</span><span class="n">o</span> <span class="n">test_mock</span>
<span class="o">./</span><span class="n">test_mock</span>

<span class="o">+</span> <span class="p">(</span><span class="mf">0.00</span><span class="n">s</span><span class="p">)</span> <span class="n">check</span> <span class="n">mocked</span> <span class="n">function</span>

<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">0.00</span> <span class="n">Seconds</span>
<span class="n">Synthesis</span><span class="p">:</span> <span class="n">SUCCESS</span> <span class="n">Tests</span><span class="p">:</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">Passing</span><span class="p">:</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">Failing</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>In the example above the function <cite>multiply_by</cite> was mocked to return 5 instead of 2, without
mocking it the test will fail because <cite>multiply_a_number(2)</cite> will return 4 instead of 10.</p>
</div>
<div class="section" id="mocking-a-function">
<h2>Mocking a function<a class="headerlink" href="#mocking-a-function" title="Permalink to this headline">¶</a></h2>
<p>The macro CESTER_MOCK_FUNCTION can be used to mock a function to with a body. Compare to the
CESTER_MOCK_SIMPLE_FUNCTION macro this macro can wrap a function that returns or does not
return a value.</p>
<p>Example:</p>
<p>The following test mock a function that accepts 2 parameters a pointer to integer and another
integer, then return the power of the first parameter.</p>
<p><strong>originals.c</strong></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">power_of</span><span class="p">(</span><span class="nb">int</span><span class="o">*</span> <span class="n">num1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">num2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">*</span><span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the function above the returned value is not correct as it does not return the actual power
of the num1 pointer. in our test we will mock the function to properly calculates the power of
the num1 pointer.</p>
<p><strong>test_mock.c</strong></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;exotic/cester.h&gt;</span>
<span class="c1">#include &quot;originals.c&quot;</span>

<span class="n">CESTER_MOCK_FUNCTION</span><span class="p">(</span><span class="n">power_of</span><span class="p">(</span><span class="nb">int</span><span class="o">*</span> <span class="n">num1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">num2</span><span class="p">),</span> <span class="nb">int</span><span class="p">,</span>
    <span class="nb">int</span> <span class="n">return_val</span> <span class="o">=</span> <span class="o">*</span><span class="n">num1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">num2</span><span class="o">--&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">return_val</span> <span class="o">*=</span> <span class="o">*</span><span class="n">num1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">return_val</span><span class="p">;</span>
<span class="p">)</span>

<span class="n">CESTER_TEST</span><span class="p">(</span><span class="n">check_mocked_function</span><span class="p">,</span> <span class="n">test_instance</span><span class="p">,</span>
    <span class="nb">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">cester_assert_equal</span><span class="p">(</span><span class="n">power_of</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Compile your test file with the –wrap option e.g. in the example above the function
<cite>power_of</cite> was mocked so the option <em>-Wl,–wrap=power_of</em> is supplied during
compilation.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="n">test_mock</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">I</span><span class="o">.</span> <span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">--</span><span class="n">wrap</span><span class="o">=</span><span class="n">power_of</span> <span class="o">-</span><span class="n">o</span> <span class="n">test_mock</span>
<span class="o">./</span><span class="n">test_mock</span>

<span class="o">+</span> <span class="p">(</span><span class="mf">0.00</span><span class="n">s</span><span class="p">)</span> <span class="n">check</span> <span class="n">mocked</span> <span class="n">function</span>

<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">0.001000</span> <span class="n">Seconds</span>
<span class="n">Synthesis</span><span class="p">:</span> <span class="n">SUCCESS</span> <span class="n">Tested</span><span class="p">:</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">Passing</span><span class="p">:</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">Failing</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>To disable mocking in a test without deleting your mock code you can chose not to compile
the test with the -Wl,–wrap option or you can define <cite>CESTER_NO_MOCK</cite> anywhere in the code.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Static functions cannot be mocked in cester.</p>
</div>
</div>
</div>


                
                </br>
                 
                    
                        <div class="navigation">
                            
                                <a class="reference navigator" style="float:left;" href="https://github.com/exoticlibraries/libcester/edit/main/docs/docs/mocking.rst"><i class="fa fa-pen"></i>Edit this page</a>    
                            
                            <a class="reference navigator" style="float:left;" href="../genindex.html"><i class="fa fa-book"></i>Index</a>
                            
                            
                                <a class="reference navigator" style="float:right;" href="options.html">Cester Options<i class="fa fa-arrow-right"></i></a> 
                            
                            
                                <a class="reference navigator" style="float:right;" href="index.html"><i class="fa fa-arrow-left"></i>Documentation</a>
                            
                        </div>
                    
                
        </div>
        
            
                
                <div class="sidebar-right">
                    
                        <h2>Page Contents</h2>
                        <ul>
<li><a class="reference internal" href="#">Mocking</a><ul>
<li><a class="reference internal" href="#mocking-a-simple-function">Mocking a simple function</a></li>
<li><a class="reference internal" href="#mocking-a-function">Mocking a function</a></li>
</ul>
</li>
</ul>

                        
                            <h2>Previous topic</h2>
                            <a href="index.html">Documentation</a>
                        
                        
                            <h2>Next topic</h2>
                            <a href="options.html">Cester Options</a>
                        
                        <h2>This Page</h2>
                        <a href="../_sources/docs/mocking.rst.txt">Show source</a>
                        
                            <br/><a style="line-height: 25px;" href="https://github.com/exoticlibraries/libcester/edit/main/docs/docs/mocking.rst">Edit this page</a>
                        
                    
                </div>
                
            
        
        <div style="clear:both"></div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        <div class="social">
            
                <a href="https://twitter.com/exoticlibs"><i class="fab fa-twitter"></i></a>
            
                <a href="https://github.com/exoticlibraries/libcester/"><i class="fab fa-github"></i></a>
            
        </div>
        <div class="footer-col1">
            
        </div>
        
        
        <div class="doc-sphinx-info">
                    &copy; Copyright 2021, Exotic Libraries - MIT License.
                Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.5
                with <a href="https://thecarisma.github.io/themata/milkish/index.html">milkish</a> theme.
        </div>
    </div>
    

  </body>
</html>